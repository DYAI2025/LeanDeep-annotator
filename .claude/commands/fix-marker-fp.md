---
description: Fix false-positive markers in source YAMLs with regex improvements
allowed-tools: Read, Write, Edit, Bash, Glob, Grep
---

## Context
LeanDeep markers use regex patterns to detect psychological/communication signals in text.
False positives arise from overly broad patterns, especially with German compound words
(e.g., "beibehalten" matching `halten`, "Vorlieben" matching `lieb`).

## Your Task

Fix one or more false-positive markers identified by the user. The user provides either:
- A list of marker IDs with the FP text
- Eval output showing inflationäre markers
- A text sample where wrong markers fire

### Steps

1. **Identify the FP marker(s)** and what text triggers them incorrectly
2. **Read the source YAML** in `build/markers_rated/{1_approved,2_good}/{LAYER}/{MARKER_ID}.yaml`
3. **Diagnose the pattern** — usually one of:
   - Missing `\b` word boundaries (German compounds)
   - Overly broad alternation group
   - Pattern matches common words (e.g., "I", "me", "okay")
   - Missing negative lookahead/lookbehind
4. **Fix the pattern** in the source YAML:
   - Add `\b` boundaries: `"(halten|umarmen)"` → `"\\b(halten|umarmen)\\b"`
   - Restrict to full words: `lieb` → `\\bliebe?\\b`
   - Add context requirements: standalone word → phrase-level pattern
   - For extremely broad patterns: add `context_only` tag (hidden from output, available for SEM composition)
5. **Run normalize**:
   ```bash
   python3 tools/normalize_schema.py
   ```
6. **Run tests**:
   ```bash
   python3 -m pytest tests/ -x -q
   ```
7. **Verify the fix** — test the previously-FP text:
   ```bash
   curl -X POST http://localhost:8420/v1/analyze -H "Content-Type: application/json" \
     -d '{"text": "<the FP text>", "threshold": 0.3}'
   ```
   Confirm the marker no longer fires on the FP text.
8. **Spot-check** — test a true-positive text to confirm the marker still detects correctly

### Guardrails
- NEVER edit `build/markers_normalized/` — always edit in `build/markers_rated/`
- German compound words ALWAYS need `\b` word boundaries
- Emojis naturally have boundaries (non-word chars) — no `\b` needed for emoji patterns
- After fixing, ALWAYS verify both: FP gone AND true positives still work
- If a pattern is too broad to fix with regex, consider `context_only` tag instead of deletion

---
*Generated by /reflect-skills from 3 session patterns*
