---
description: Run full marker enrichment pipeline — normalize → enrich → eval → report
allowed-tools: Bash, Read, Grep, Glob
---

## Context
The LeanDeep marker pipeline transforms source YAMLs through several enrichment stages
and evaluates against a gold corpus (99K messages). Each tool reads from and writes to
`build/markers_rated/` (source) or `build/markers_normalized/` (generated).

## Your Task

Run the full pipeline and report results. Optionally run only specific stages.

### Full Pipeline (default)

```bash
# 1. Normalize: source YAMLs → unified schema + registry JSON
python3 tools/normalize_schema.py

# 2. Enrich LD5: add families, multipliers, ARS, EWMA fields
python3 tools/enrich_ld5.py

# 3. Enrich VAD: add vad_estimate + effect_on_state
python3 tools/enrich_vad.py

# 4. Enrich negatives: add negative examples (98.8% coverage)
python3 tools/enrich_negatives.py

# 5. Run tests (ensure no regression)
python3 -m pytest tests/ -x -q

# 6. Eval: marker detection against gold corpus
python3 tools/eval_corpus.py

# 7. Eval dynamics: VAD/UED/state trends over corpus
python3 tools/eval_dynamics.py
```

### Report Template

After running, report:
- **Markers:** Total / per layer / per rating
- **VAD coverage:** N markers with vad_estimate
- **Detection stats:** Unique markers firing, avg confidence per layer
- **Top inflationäre markers:** Markers with suspiciously high detection count
- **Regression check:** Any previously-firing markers now silent? Any new markers firing?
- **State trends:** Trust/conflict/deesc delta (early vs late)

### Partial Runs

User may request only specific stages:
- "just normalize" → step 1 only
- "normalize and eval" → steps 1 + 6
- "enrich VAD" → steps 1 + 3 (normalize first, then VAD)
- "full pipeline" → all 7 steps

### Guardrails
- ALWAYS run normalize (step 1) before any enrichment — enrichment reads from normalized files
- ALWAYS run tests (step 5) before eval — catch schema errors early
- eval_corpus.py can take ~90s on the full gold corpus — warn the user
- Do NOT modify source files — this skill is read-only (pipeline reads + generates)

---
*Generated by /reflect-skills from 2 session patterns*
